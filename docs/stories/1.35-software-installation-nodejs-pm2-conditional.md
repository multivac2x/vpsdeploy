# Story 1.35: Software Installation - Node.js and PM2 (Conditional)

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify Node.js and PM2 are only installed if any domain in registry is dynamic.

## Acceptance Criteria

- [x] Fresh VPS, first domain is static: Node.js and PM2 are NOT installed
- [x] Second domain is dynamic: script detects existing dynamic domain in registry
- [x] Node.js installed via nvm (latest LTS) for deploy user
- [x] PM2 installed globally via npm
- [x] `pm2 startup` configured for deploy user
- [x] If registry already has dynamic domains, new static domain run does NOT uninstall Node.js/PM2 (they remain)

## Dependencies

Stories 1.11, 1.10

## Testing Notes

```bash
# Fresh VPS, first domain static
./setup-vps.sh --dry-run --verbose
# Should NOT show Node.js/PM2 installation

# Add dynamic domain
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=dynamic.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF
./setup-vps.sh --dry-run --verbose
# Should show Node.js/PM2 installation

# After adding static domain again (with dynamic already in registry)
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=another-static.com
DOMAIN_TYPE=static
EOF
./setup-vps.sh --dry-run --verbose
# Node.js/PM2 should NOT be uninstalled (they remain installed)
```

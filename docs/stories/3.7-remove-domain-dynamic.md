# Story 3.7: Remove Domain - Dynamic

**Epic:** Epic 3 - Integration and End-to-End Testing
**Priority:** Must-have

## Description

Verify complete removal of dynamic domain.

## Acceptance Criteria

- [x] Dynamic domain exists and PM2 process running
- [x] Run `./setup-vps.sh remove` and confirm
- [x] Domain removed from registry
- [x] PM2 process stopped and deleted
- [x] `pm2 save` executed
- [x] Caddyfile regenerated and reloaded
- [x] Domain no longer accessible via HTTPS
- [x] App code remains in `/home/deploy/apps/example.com/`
- [x] `setup-vps.sh status` no longer shows domain

## Dependencies

Stories 3.2, 1.26

## Testing Notes

```bash
# 1. Ensure dynamic domain is configured and PM2 running
./setup-vps.sh status
# Should show domain with âœ… status

# 2. Remove domain
./setup-vps.sh remove
# Answer 'y' to confirmation

# 3. Check registry
ssh deploy@vps "sudo cat /etc/caddy/domains.json" | jq '.domains | keys'
# Should NOT include removed domain

# 4. Check PM2 process
ssh deploy@vps "pm2 list | grep example.com"
# Should not show the process

# 5. Check Caddyfile
ssh deploy@vps "sudo cat /etc/caddy/Caddyfile" | grep "example.com"
# Should not appear

# 6. Test HTTPS
curl -I https://example.com
# Should return error

# 7. Check app code still exists
ssh deploy@vps "ls -ld /home/deploy/apps/example.com"
# Should still exist

# 8. Status command
./setup-vps.sh status
# Should not show removed domain
```

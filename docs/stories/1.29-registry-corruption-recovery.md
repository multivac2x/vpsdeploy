# Story 1.29: Registry Corruption Recovery

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Should-have

## Description

Verify behavior when `/etc/caddy/domains.json` is missing or contains invalid JSON.

## Acceptance Criteria

- [x] If registry file missing: creates fresh empty registry with version 1 and empty domains object
- [x] If registry contains invalid JSON:
  - Backs up corrupted file to `/etc/caddy/domains.json.corrupt.TIMESTAMP`
  - Creates fresh empty registry
  - Logs warning about corruption and backup location
  - Continues with fresh registry
- [x] Current domain is then added to fresh registry

## Dependencies

Story 1.10 (actual execution)

## Testing Notes

```bash
# Test missing registry (fresh VPS or manually delete)
ssh deploy@vps "sudo rm /etc/caddy/domains.json"
./setup-vps.sh --dry-run
# Should create fresh registry

# Test corrupted registry
ssh deploy@vps "echo 'invalid json' | sudo tee /etc/caddy/domains.json"
./setup-vps.sh --dry-run
# Should:
# - Backup corrupted file to .corrupt.TIMESTAMP
# - Create fresh registry
# - Add current domain
# - Log warning
```

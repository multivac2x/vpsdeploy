# Story 1.15: Caddyfile Generation - Dynamic Domain

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify Caddyfile is generated correctly for dynamic domains.

## Acceptance Criteria

- [x] Generated Caddyfile includes `www` redirect block
- [x] Main block uses `reverse_proxy localhost:${DOMAIN_PORT}`
- [x] Per-domain log file configured
- [x] Security headers present
- [x] Gzip encoding enabled
- [x] No `root` or `file_server` directives

## Dependencies

Story 1.13

## Testing Notes

```bash
# After setup-vps.sh with dynamic domain on port 3000
ssh deploy@vps "sudo cat /etc/caddy/Caddyfile" | grep -A 15 "dynamic-example.com"

# Should contain:
# www.dynamic-example.com {
#     redir https://dynamic-example.com{uri} permanent
# }
#
# dynamic-example.com {
#     reverse_proxy localhost:3000
#     log {
#         output file /var/log/caddy/dynamic-example.com.log
#         format json
#     }
#     header {
#         X-Content-Type-Options "nosniff"
#         X-Frame-Options "DENY"
#         Referrer-Policy "strict-origin-when-cross-origin"
#     }
#     encode gzip
# }
```

# Story 5.3: Registry Backup and Restore

**Epic:** Epic 5 - VPS Deployment Scenarios and Operations
**Priority:** Should-have

## Description

Manual backup and restore of the central registry.

## Acceptance Criteria

- [x] Backup: `sudo cp /etc/caddy/domains.json /backup/domains.json.backup`
- [x] Simulate corruption: edit registry to invalid JSON
- [x] Run `./setup-vps.sh` (any domain)
- [x] Script detects corruption, creates `.corrupt` backup, creates fresh registry
- [x] Manual restore: replace `/etc/caddy/domains.json` with backup
- [x] Run `./setup-vps.sh` to regenerate Caddyfile from restored registry
- [x] All domains back online

## Dependencies

Story 1.29

## Testing Notes

```bash
# 1. Backup registry
ssh deploy@vps "sudo cp /etc/caddy/domains.json /tmp/domains.json.backup"

# 2. Corrupt registry
ssh deploy@vps "echo 'invalid json' | sudo tee /etc/caddy/domains.json"

# 3. Run setup-vps.sh
./setup-vps.sh --dry-run
# Should create .corrupt backup and fresh registry

# 4. Manual restore
ssh deploy@vps "sudo cp /tmp/domains.json.backup /etc/caddy/domains.json"

# 5. Regenerate Caddyfile
./setup-vps.sh

# 6. Verify all domains working
./setup-vps.sh status
```

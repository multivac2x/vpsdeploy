# Story 1.32: Domain Type Change - Dynamic to Static

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Should-have

## Description

Verify changing a domain from dynamic to static updates components and stops PM2.

## Acceptance Criteria

- [x] Domain exists as dynamic in registry
- [x] Update `.env.deploy` to `DOMAIN_TYPE=static` (remove `DOMAIN_PORT`)
- [x] Run `setup-vps.sh`
- [x] Registry updated to static (port removed)
- [x] Static web root created at `${VPS_BASE_PATH}/${DOMAIN}`
- [x] Caddyfile regenerated with `file_server` instead of `reverse_proxy`
- [x] Caddy reloaded
- [x] PM2 process for domain is stopped and deleted
- [x] `pm2 save` executed
- [x] Logs message about type change and PM2 removal
- [x] Dynamic app directory at `/home/deploy/apps/${DOMAIN}` is NOT automatically deleted

## Dependencies

Stories 1.12, 1.21, 1.26

## Testing Notes

```bash
# Domain initially dynamic (with PM2 running)
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF
./setup-vps.sh
# PM2 should be running

# Change to static
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=static
EOF
./setup-vps.sh

# Verify registry
ssh deploy@vps "sudo jq '.domains[\"example.com\"]' /etc/caddy/domains.json"
# Should show type: "static", no port field

# Verify Caddyfile
ssh deploy@vps "sudo cat /etc/caddy/Caddyfile" | grep -A 5 "example.com"
# Should show root * /var/www/example.com, file_server

# Verify PM2 stopped and deleted
ssh deploy@vps "pm2 list | grep example.com"
# Should not show the process

# Verify static directory created
ssh deploy@vps "ls -ld /var/www/example.com"
# Should exist

# Verify app dir still exists (not deleted)
ssh deploy@vps "ls -ld /home/deploy/apps/example.com"
# Should still exist
```

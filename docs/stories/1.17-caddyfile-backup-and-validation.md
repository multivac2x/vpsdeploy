# Story 1.17: Caddyfile Backup and Validation

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify that existing Caddyfile is backed up before regeneration and validated after.

## Acceptance Criteria

- [x] If Caddyfile exists, it is backed up to `/etc/caddy/backups/Caddyfile.YYYYMMDD_HHMMSS`
- [x] Backup directory is created if missing
- [x] New Caddyfile is validated with `caddy validate` before reload
- [x] If validation fails, backup is restored and old config remains active
- [x] Script exits with error if validation fails after backup restoration

## Dependencies

Stories 1.14, 1.15 (actual execution)

## Testing Notes

```bash
# Check backup directory exists after first run
ssh deploy@vps "ls -ld /etc/caddy/backups"
# Should exist

# List backups
ssh deploy@vps "ls /etc/caddy/backups/"
# Should show Caddyfile.TIMESTAMP files

# To test validation failure, corrupt the registry (e.g., set port to "abc" instead of number)
# Then run setup-vps.sh
# Should see:
# - Backup of invalid Caddyfile created
# - Original Caddyfile restored
# - Error message
# - Exit code 1
```

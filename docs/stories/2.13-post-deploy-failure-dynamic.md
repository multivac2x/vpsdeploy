# Story 2.13: Post-Deploy Failure - Dynamic

**Epic:** Epic 2 - deploy.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify script handles npm install or PM2 restart failures.

## Acceptance Criteria

- [x] If `npm install --production` fails, script exits with error
- [x] If `npm run build` fails, script exits with error
- [x] If `pm2 restart` fails, script exits with error
- [x] Error messages include command output for debugging
- [x] Script does NOT continue after post-deploy failure

## Dependencies

Story 2.6

## Testing Notes

```bash
# Simulate npm install failure by having invalid dependency
cat > package.json << 'EOF'
{
  "name": "test",
  "version": "1.0.0",
  "dependencies": {
    "nonexistent-package-xyz": "1.0.0"
  },
  "scripts": {
    "build": "echo build"
  }
}
EOF

cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF

./deploy.sh
echo $?  # Should be non-zero (npm install failure)
```

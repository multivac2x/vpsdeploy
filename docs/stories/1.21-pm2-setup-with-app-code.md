# Story 1.21: PM2 Setup - Dynamic Domain with App Code

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify PM2 process management when app code is already deployed.

## Acceptance Criteria

- [x] `package.json` exists in app directory
- [x] If PM2 process with name `${PM2_APP_NAME}` (or `${DOMAIN}`) exists, it is restarted
- [x] If process doesn't exist, it is started with `pm2 start npm --name '${DOMAIN}' -- start`
- [x] `pm2 save` is executed
- [x] `pm2 startup` is configured if not already enabled (detected via `systemctl is-enabled pm2-${VPS_USER}`)
- [x] PM2 process status is "online" after setup

## Dependencies

Stories 1.19, 1.20 (directories created), deploy.sh must have run first

## Testing Notes

```bash
# Prerequisites: deploy.sh already deployed code to /home/deploy/apps/example.com/
./setup-vps.sh

# Check PM2 process
ssh deploy@vps "pm2 list | grep example.com"
# Should show: online

# Check startup configured
ssh deploy@vps "systemctl is-enabled pm2-deploy"
# Should show: enabled
```

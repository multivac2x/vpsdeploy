# Story 3.1: Full Workflow - Static Domain

**Epic:** Epic 3 - Integration and End-to-End Testing
**Priority:** Must-have

## Description

Complete end-to-end test: setup VPS then deploy static site.

## Acceptance Criteria

- [ ] Fresh VPS (Ubuntu 22.04/24.04, deploy user with sudo, no Caddy/Node/PM2)
- [ ] Run `./setup-vps.sh` with static domain config
- [ ] VPS has Caddy installed and running
- [ ] `/etc/caddy/domains.json` created with domain entry
- [ ] `/var/www/example.com/` exists and owned by deploy
- [ ] Caddyfile generated and Caddy reloaded
- [ ] Run `./deploy.sh` (or `./deploy.sh --skip-build` if build already done)
- [ ] Static files transferred to `/var/www/example.com/`
- [ ] `https://example.com` returns 200 and serves site
- [ ] SSL certificate obtained automatically by Caddy

## Dependencies

Stories 1.1-1.39, 2.1-2.14

## Testing Notes

This is a full integration test requiring a real VPS.

```bash
# 1. Start with fresh VPS
# 2. Configure .env.deploy for static domain
# 3. Run: ./setup-vps.sh
# 4. Verify Caddy running: ssh deploy@vps "systemctl status caddy"
# 5. Verify registry: ssh deploy@vps "sudo cat /etc/caddy/domains.json" | jq .
# 6. Verify directory: ssh deploy@vps "ls -ld /var/www/example.com"
# 7. Run: ./deploy.sh
# 8. Verify files transferred
# 9. Test HTTPS: curl -I https://example.com (should return 200)
# 10. Check SSL: openssl s_client -connect example.com:443 -servername example.com | openssl x509 -noout -dates
```

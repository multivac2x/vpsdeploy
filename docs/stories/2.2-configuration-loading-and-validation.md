# Story 2.2: Configuration Loading and Validation

**Epic:** Epic 2 - deploy.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify `.env.deploy` is loaded correctly and required variables are validated.

## Acceptance Criteria

- [ ] Script loads `.env.deploy` from same directory
- [ ] Required variables: `VPS_USER`, `VPS_IP`, `DOMAIN`, `DOMAIN_TYPE`
- [ ] If missing, error message shows which variable and exits with code 1
- [ ] Optional variables use defaults: `VPS_BASE_PATH=/var/www`, `VPS_APPS_PATH=/home/deploy/apps`, `SSH_PORT=22`, `BUILD_CMD="npm run build"`, `BUILD_OUTPUT="out"`
- [ ] `DOMAIN_PORT` validated if `DOMAIN_TYPE=dynamic` (same rules as setup-vps.sh)

## Dependencies

Story 2.1

## Testing Notes

```bash
# Test missing required vars
cat > .env.deploy << 'EOF'
VPS_USER=deploy
EOF
./deploy.sh --dry-run
echo $?  # Should be 1

# Test invalid DOMAIN_TYPE
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=164.90.xxx.xxx
DOMAIN=example.com
DOMAIN_TYPE=invalid
EOF
./deploy.sh --dry-run
echo $?  # Should be 1

# Test missing DOMAIN_PORT for dynamic
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=164.90.xxx.xxx
DOMAIN=example.com
DOMAIN_TYPE=dynamic
EOF
./deploy.sh --dry-run
echo $?  # Should be 1

# Valid config
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=static
EOF
./deploy.sh --dry-run
echo $?  # Should be 0
```

# Story 1.13: Port Conflict Detection

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify that attempting to assign a port already in use by another dynamic domain fails with clear error.

## Acceptance Criteria

- [x] Registry contains dynamic domain A with port 3000
- [x] Attempt to add/update dynamic domain B with port 3000
- [x] Script exits with code 1 BEFORE making any changes
- [x] Error message lists the conflicting domain name and port
- [x] Registry remains unchanged (no partial merge)

## Dependencies

Story 1.11

## Testing Notes

```bash
# Ensure domain A with port 3000 exists in registry
# Then try to add domain B with same port
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=conflict-domain.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF

./setup-vps.sh --dry-run
echo $?  # Should be 1

# Check registry unchanged (domain B not added)
ssh deploy@vps "sudo jq '.domains | keys' /etc/caddy/domains.json"
# Should NOT include conflict-domain.com
```

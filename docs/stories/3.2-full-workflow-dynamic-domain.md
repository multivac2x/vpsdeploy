# Story 3.2: Full Workflow - Dynamic Domain

**Epic:** Epic 3 - Integration and End-to-End Testing
**Priority:** Must-have

## Description

Complete end-to-end test: setup VPS then deploy dynamic Next.js app.

## Acceptance Criteria

- [ ] Fresh VPS
- [ ] Run `./setup-vps.sh` with dynamic domain config (port 3000)
- [ ] VPS has Caddy, Node.js (nvm LTS), PM2 installed
- [ ] `/home/deploy/apps/example.com/` exists
- [ ] Caddyfile generated with reverse_proxy to localhost:3000
- [ ] Caddy reloaded
- [ ] Run `./deploy.sh`
- [ ] Project code transferred to `/home/deploy/apps/example.com/`
- [ ] Post-deploy: `npm install --production` executed
- [ ] Post-deploy: `npm run build` executed (if needed)
- [ ] PM2 process started and running
- [ ] `https://example.com` returns 200 and serves Next.js app
- [ ] SSL certificate obtained

## Dependencies

Stories 1.1-1.39, 2.1-2.14

## Testing Notes

```bash
# 1. Fresh VPS
# 2. Configure .env.deploy for dynamic domain (DOMAIN_TYPE=dynamic, DOMAIN_PORT=3000)
# 3. Run: ./setup-vps.sh
# 4. Verify Node.js: ssh deploy@vps "node --version"
# 5. Verify PM2: ssh deploy@vps "pm2 --version"
# 6. Verify app dir: ssh deploy@vps "ls -ld /home/deploy/apps/example.com"
# 7. Verify Caddyfile has reverse_proxy
# 8. Run: ./deploy.sh
# 9. Verify PM2 process: ssh deploy@vps "pm2 list | grep example.com"
# 10. Test HTTPS: curl -I https://example.com (should return 200)
```

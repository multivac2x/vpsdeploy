# Story 3.5: Domain Type Change - Dynamic to Static

**Epic:** Epic 3 - Integration and End-to-End Testing
**Priority:** Should-have

## Description

Verify full workflow of changing a domain from dynamic to static.

## Acceptance Criteria

- [ ] Domain initially set up as dynamic, app running via PM2
- [ ] Update `.env.deploy` to `DOMAIN_TYPE=static` (remove `DOMAIN_PORT`)
- [ ] Run `setup-vps.sh`
- [ ] Registry updated, PM2 process stopped and deleted
- [ ] Static web root created
- [ ] Caddyfile updated with file_server
- [ ] Caddy reloaded
- [ ] Deploy static build with `deploy.sh`
- [ ] Domain now serves static site
- [ ] Old app code remains in `/home/deploy/apps/` (not deleted automatically)

## Dependencies

Stories 3.1, 3.2, 1.32

## Testing Notes

```bash
# 1. Setup as dynamic
# 2. Deploy dynamic app
# 3. Verify working: https://example.com (PM2 running)

# 4. Change .env.deploy to static
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=static
EOF

# 5. Run setup-vps.sh
./setup-vps.sh

# 6. Verify registry shows static (no port)
ssh deploy@vps "sudo jq '.domains[\"example.com\"]' /etc/caddy/domains.json"

# 7. Verify PM2 process stopped/deleted
ssh deploy@vps "pm2 list | grep example.com"
# Should not show the process

# 8. Verify Caddyfile has file_server
ssh deploy@vps "sudo cat /etc/caddy/Caddyfile" | grep -A 5 "example.com"

# 9. Deploy static build
./deploy.sh

# 10. Test HTTPS: should serve static site
curl -I https://example.com

# 11. Check old app code still exists (not deleted)
ssh deploy@vps "ls -ld /home/deploy/apps/example.com"
```

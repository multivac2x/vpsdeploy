# Story 2.6: Post-Deploy - Dynamic Site NPM Install and PM2 Restart

**Epic:** Epic 2 - deploy.sh Core Functionality Testing
**Priority:** Must-have

## Description

Verify post-deploy steps for dynamic sites.

## Acceptance Criteria

- [x] After rsync completes, SSH into VPS
- [x] Run: `cd ${VPS_APPS_PATH}/${DOMAIN} && npm install --production`
- [x] Run: `npm run build` (if build step needed on server)
- [x] Run: `pm2 restart ${DOMAIN}` (or `${PM2_APP_NAME}` if set)
- [x] If PM2 process doesn't exist, start it: `pm2 start npm --name '${DOMAIN}' -- start`
- [x] Logs success message with verification URL

## Dependencies

Stories 2.5 (dynamic only)

## Testing Notes

```bash
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF

./deploy.sh --dry-run --verbose 2>&1 | grep -A 3 "Post-deploy"
# Should show:
# cd /home/deploy/apps/example.com && npm install --production
# npm run build
# pm2 restart example.com
```

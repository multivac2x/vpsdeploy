# Story 1.31: Domain Type Change - Static to Dynamic

**Epic:** Epic 1 - setup-vps.sh Core Functionality Testing
**Priority:** Should-have

## Description

Verify changing a domain from static to dynamic updates all components correctly.

## Acceptance Criteria

- [x] Domain exists as static in registry
- [x] Update `.env.deploy` to `DOMAIN_TYPE=dynamic` with valid `DOMAIN_PORT`
- [x] Run `setup-vps.sh`
- [x] Registry entry updated to dynamic with port
- [x] Dynamic app directory created at `${VPS_APPS_PATH}/${DOMAIN}`
- [x] Caddyfile regenerated with `reverse_proxy` instead of `root/file_server`
- [x] Caddy reloaded
- [x] Logs message about type change
- [x] Static directory at `/var/www/${DOMAIN}` is NOT automatically deleted (documented behavior)

## Dependencies

Stories 1.12, 1.20

## Testing Notes

```bash
# Domain initially static
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=static
EOF
./setup-vps.sh

# Change to dynamic
cat > .env.deploy << 'EOF'
VPS_USER=deploy
VPS_IP=your.vps.ip
DOMAIN=example.com
DOMAIN_TYPE=dynamic
DOMAIN_PORT=3000
EOF
./setup-vps.sh

# Verify changes
ssh deploy@vps "sudo jq '.domains[\"example.com\"]' /etc/caddy/domains.json"
# Should show type: "dynamic", port: 3000, app_dir: "/home/deploy/apps/example.com"

ssh deploy@vps "ls -ld /home/deploy/apps/example.com"
# Should exist

ssh deploy@vps "sudo cat /etc/caddy/Caddyfile" | grep -A 5 "example.com"
# Should show reverse_proxy localhost:3000

# Check static dir still exists (not deleted)
ssh deploy@vps "ls -ld /var/www/example.com"
# Should still exist
```
